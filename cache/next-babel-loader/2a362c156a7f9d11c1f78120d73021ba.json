{"ast":null,"code":"import _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport * as superagent from 'superagent';\nimport { baseURl } from '../config';\n\nvar _default =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(_default, _React$Component);\n\n  _createClass(_default, null, [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(_ref) {\n      var req, db, _list, _ref2, list;\n\n      return _regeneratorRuntime.async(function getInitialProps$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              req = _ref.req;\n\n              if (!req) {\n                _context.next = 7;\n                break;\n              }\n\n              db = req.db;\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(db.collection('Registrations').find().sort({\n                createdAt: -1\n              }).toArray());\n\n            case 5:\n              _list = _context.sent;\n              return _context.abrupt(\"return\", {\n                list: _list\n              });\n\n            case 7:\n              _context.next = 9;\n              return _regeneratorRuntime.awrap(superagent.get(baseURl).then(function (res) {\n                return res.body;\n              }));\n\n            case 9:\n              _ref2 = _context.sent;\n              list = _ref2.list;\n              return _context.abrupt(\"return\", {\n                list: list\n              });\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    }\n  }]);\n\n  function _default() {\n    var _this;\n\n    _classCallCheck(this, _default);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(_default).call(this));\n    _this.state = {\n      formData: {\n        email: '',\n        name: '',\n        phone: '',\n        type: '',\n        count: 0\n      }\n    };\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"setForm\",\n    value: function setForm(prop) {\n      var _this2 = this;\n\n      return function (ev) {\n        var state = _this2.state || {};\n        var formData = state.formData || {};\n\n        _this2.setState(_Object$assign({}, state, {\n          formData: _Object$assign({}, formData, _defineProperty({}, prop, ev.target.value))\n        }));\n      };\n    }\n  }, {\n    key: \"isFormInvalid\",\n    value: function isFormInvalid() {\n      var state = this.state || {};\n      var formData = state.formData || {};\n      return !formData.email || !formData.name || !formData.phone || !formData.type || !formData.count;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(_id) {\n      var _this3 = this;\n\n      return function (ev) {\n        superagent.del(\"\".concat(baseURl, \"/\").concat(_id)).then(function () {\n          var state = _this3.state || {};\n          var list = _this3.state.list || _this3.props.list || [];\n\n          _this3.setState(_Object$assign({}, state, {\n            list: list.filter(function (registration) {\n              return registration._id !== _id;\n            })\n          }));\n        })[\"catch\"](function (error) {\n          return console.error(error.stack);\n        });\n      };\n    }\n  }, {\n    key: \"add\",\n    value: function add() {\n      var _this4 = this;\n\n      return function (ev) {\n        ev.preventDefault();\n        var state = _this4.state || {};\n        var formData = state.formData || {};\n\n        _this4.setState(_Object$assign({}, _this4.state, {\n          formData: {\n            email: '',\n            name: '',\n            phone: '',\n            type: '',\n            count: 0\n          }\n        }));\n\n        superagent.post(baseURl, formData).then(function (res) {\n          var state = _this4.state || {};\n          var list = _this4.state.list || _this4.props.list || [];\n          debugger;\n\n          _this4.setState(_Object$assign({}, state, {\n            list: [res.body.registration].concat(list)\n          }));\n        })[\"catch\"](function (error) {\n          return console.error(error.stack);\n        });\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      var list = this.state.list || this.props.list;\n      var formData = this.state.formData;\n      console.log(this.props.query);\n      return __jsx(\"div\", {\n        id: \"container\",\n        className: \"jsx-2512804896\"\n      }, __jsx(\"h1\", {\n        className: \"jsx-2512804896\"\n      }, \"New Book\"), __jsx(\"div\", {\n        id: \"input-registration\",\n        className: \"jsx-2512804896\"\n      }, __jsx(\"form\", {\n        onSubmit: this.add(),\n        className: \"jsx-2512804896\"\n      }, __jsx(\"input\", {\n        type: \"text\",\n        onChange: this.setForm('name'),\n        value: formData.name,\n        placeholder: \"Name\",\n        className: \"jsx-2512804896\"\n      }), __jsx(\"input\", {\n        type: \"text\",\n        onChange: this.setForm('email'),\n        value: formData.email,\n        placeholder: \"Email\",\n        className: \"jsx-2512804896\"\n      }), __jsx(\"input\", {\n        type: \"text\",\n        onChange: this.setForm('phone'),\n        value: formData.phone,\n        placeholder: \"Phone\",\n        className: \"jsx-2512804896\"\n      }), __jsx(\"input\", {\n        type: \"text\",\n        onChange: this.setForm('type'),\n        value: formData.type,\n        placeholder: \"Ticket Type\",\n        className: \"jsx-2512804896\"\n      }), __jsx(\"input\", {\n        type: \"text\",\n        onChange: this.setForm('count'),\n        value: formData.count,\n        placeholder: \"Count\",\n        className: \"jsx-2512804896\"\n      }), __jsx(\"button\", {\n        disabled: this.isFormInvalid(),\n        className: \"jsx-2512804896\"\n      }, \"Add\"))), __jsx(\"h1\", {\n        className: \"jsx-2512804896\"\n      }, \"Registrations\"), __jsx(\"div\", {\n        id: \"registrations\",\n        className: \"jsx-2512804896\"\n      }, list.length > 0 && __jsx(\"ul\", {\n        className: \"jsx-2512804896\"\n      }, list.map(function (registration) {\n        return __jsx(\"div\", {\n          key: registration._id,\n          className: \"jsx-2512804896\"\n        }, __jsx(\"span\", {\n          onClick: _this5.remove(registration._id),\n          className: \"jsx-2512804896\" + \" \" + \"remove\"\n        }, \"\\xD7\"), \"\\xA0\", __jsx(\"span\", {\n          className: \"jsx-2512804896\" + \" \" + \"description\"\n        }, __jsx(\"i\", {\n          className: \"jsx-2512804896\"\n        }, registration.name), \" by \", registration.email), __jsx(\"span\", {\n          className: \"jsx-2512804896\" + \" \" + \"phone\"\n        }, registration.phone), __jsx(\"span\", {\n          className: \"jsx-2512804896\" + \" \" + \"type\"\n        }, registration.type), __jsx(\"span\", {\n          className: \"jsx-2512804896\" + \" \" + \"count\"\n        }, registration.count));\n      }))), __jsx(_JSXStyle, {\n        id: \"2512804896\"\n      }, [\"div.jsx-2512804896{font-family:'Helvetica','sans-serif';}\", \"#container.jsx-2512804896{width:800px;margin-left:auto;margin-right:auto;}\", \"h1.jsx-2512804896{color:#ccbc1d;}\", \"button.jsx-2512804896{background-color:#ff257b;color:#ffffff;font-weight:bold;border:0px;border-radius:2px;padding:5px;padding-left:8px;padding-right:8px;margin:5px;}\", \"input.jsx-2512804896{padding:5px;border:0px;background-color:#f0f0f0;margin:5px;}\", \".description.jsx-2512804896{position:relative;top:-0.2em;}\", \".remove.jsx-2512804896{cursor:pointer;color:#ff257b;font-size:1.5em;}\"]));\n    }\n  }]);\n\n  return _default;\n}(React.Component);\n\nexport { _default as default };","map":null,"metadata":{},"sourceType":"module"}